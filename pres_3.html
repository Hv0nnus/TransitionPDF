<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Présentation</title>
        <style>
            .cont {
                width: 1280px;
                height: 720px;
                position: relative;
            }
            .cont * {
                position: absolute;
                left: 0; top: 0;
                max-width: 100%;
                height: 100%;
            }
            .cont>* {
                visibility: hidden;
            }
            .cont>.current {
                visibility: visible;
            }
            .cont>div {
                width: 100%;
            }
            .cont>div>video:not(.show) {
                display: none;
            }
        </style>
    </head>
    <body>

        <!--
SOME COMMANDS FOR GENERATING THE VIDEOS:
pip install webm
webm -i pdftoimage/gif_generated/0-1.gif vids/0-1.mp4
webm -i pdftoimage/gif_generated/1-2.gif vids/1-2.mp4
ffmpeg -i vids/1-2.mp4 -vf reverse vids/2-1.mp4
-->

        <div class="controls">
            <button onclick="step(-1)">«</button>
            <button onclick="step( 1)">»</button>
        </div>
        <div class="cont">
            <!-- METTRE CI-DESSOUS LES SLIDES -->
            <img src="./pdftoimage/png_generated/0-1.png"/>
	    <!-- <iframe src="./pdftoimage/pdf_generated/0.pdf" height="200" width="600"></iframe> -->
            <video src="./vids/0-1.mp4"></video> <!-- just a video transition, play only forward -->
            <!--img src="./pdftoimage/gif_generated/0-1.gif"/-->
            <img src="./pdftoimage/png_generated/1-1.png"/>
            <div>
                <video src="./vids/1-2.mp4"></video>
                <video src="./vids/2-1.mp4"></video>
            </div>
            <!--img src="./pdftoimage/gif_generated/1-2.gif"/-->
            <img src="./pdftoimage/png_generated/2-1.png"/>
            <img src="./pdftoimage/gif_generated/2-3.gif"/>
            <img src="./pdftoimage/png_generated/3-1.png"/>
            <img src="./pdftoimage/gif_generated/3-4.gif"/>
            <img src="./pdftoimage/png_generated/4-1.png"/>
            <img src="./pdftoimage/gif_generated/4-5.gif"/>
            <img src="./pdftoimage/png_generated/5-1.png"/>
            <img src="./pdftoimage/gif_generated/5-6.gif"/>
            <img src="./pdftoimage/png_generated/6-1.png"/>
            <img src="./pdftoimage/gif_generated/6-7.gif"/>
            <img src="./pdftoimage/png_generated/7-1.png"/>
            <img src="./pdftoimage/gif_generated/7-8.gif"/>
            <img src="./pdftoimage/png_generated/8-1.png"/>
            <img src="./pdftoimage/gif_generated/8-9.gif"/>
            <img src="./pdftoimage/png_generated/9-1.png"/>

            
        </div>
        
        <script>
            nothing = () => {}
            current = 0
            onstep = nothing
            
            function step(s) {
                {
                    os = onstep
                    onstep = nothing
                    os()
                    current = Math.max(0, current+s)
                    console.log('CURRENT', current)
                }

                let dir = s<0 ? 'backward' : 'foward'
                let slides = Array.from(document.querySelectorAll('.cont>*'))
                let c = current
                let im = slides[c]

                let playVideoThenStep = (im, thenStep) => {
                    im.playbackRate = 5 // speedup of the transition
                    im.onended = () => {
                        step(thenStep)
                    }
                    im.parentElement.classList.add('current') // so that it is shown and no lazy optimization can be done to not seek the video
                    im.onseeked = () => {
                        slides.forEach((e,i) => e.classList.toggle('current', i==c))
                        im.play()
                    }
                    im.currentTime = 0
                    onstep = () => {
                        im.onended = im.onseeked = undefined
                        im.pause()
                    }
                }

                // different slide types
                if (im.tagName == 'IMG') {
                    if (im && im.src) {
                        if (im.src.endsWith('.gif')) {
                            let url = im.src
                            im.src = ''
                            im.onerror = im.onload = () => {
                                im.onerror = im.onload = undefined
                                slides.forEach((e,i) => e.classList.toggle('current', i==c))
                            }
                            setTimeout(() => {im.src = url}, 0)
                        } else {
                            slides.forEach((e,i) => e.classList.toggle('current', i==c))
                        }
                    }
                } else if (im.tagName ==  'DIV') {
                    let target = im.children[dir == 'backward' ? 1 : 0]
                    let nextStep = dir == 'backward' ? -1 : +1
                    console.log(im.tagName, target, nextStep, Array.from(im.children))
                    Array.from(im.children).forEach(e => e.classList.toggle('show', e==target))
                    playVideoThenStep(target, nextStep)
                } else if (im.tagName == 'VIDEO') {
                    if (dir == 'backward') {
                        step(-1)
                        return
                    }
                    playVideoThenStep(im, 1)
                }
            }
            step(0)

            window.addEventListener('keydown', ev => {
                let use = true
                if (ev.code == 'ArrowRight') {
                    step(1)
                } else if (ev.code == 'ArrowLeft') {
                    step(-1)
                } else {
                    use = false
                }
                if (use) {
                    ev.preventDefault()
                }
            })
        </script>
    </body>
</html>
